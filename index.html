<script type="text/javascript" src="lib/jquery/dist/jquery.min.js"></script>

<script type="text/javascript" src="lib/splitter/splitter.js"></script>

<link rel="stylesheet/less" type="text/css" href="styles/theme.less">

<link rel="stylesheet/less" type="text/css" href="styles/codemirror.less">
<link rel="stylesheet" href="lib/codemirror/lib/codemirror.css">
<script src="lib/codemirror/lib/codemirror.js"></script>
<script src="styles/codemirror/clike.js"></script>
<script src="styles/codemirror/mips.js"></script>

<script src="lib/less/dist/less-1.3.0.min.js"></script>

<script src="lib/jcc/c.js"></script> <!-- TODO: remove this --!>
<script src="lib/jcc/jcc.js"></script>
<script src="lib/mips/mips.js"></script>

<style>
body {
  margin: 0;
  overflow: hidden;
}
.splitter {
  height: 100%;
  width: 100%;
}
.splitter div {
}
.vsplitbar {
  width: 5px;
  background: #aaa;
}
.hsplitbar {
  height: 5px;
  background: #aaa;
}
.CodeMirror {
  display: block;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 9999;
  margin: 0;
  padding: 0;
  border: 0px solid #BBBBBB;
  opacity: 1;
  font-size: 12pt;
  overflow: auto;
}
</style>
<script>
var compiler = JCC();
var editor;
function handle_code() {
  mipsviewer.setValue('');
  try {
    compiler.compile(editor.getValue());
  } catch(err) {
    // TODO
    return;
  }
  mipsviewer.setValue(compiler.asm);
}
$().ready(function() {
  $('#ConsoleSplitter').splitter(
    { splitHorizontal: true,
      resizeTo: window});
  $('#CodeViewSplitter').splitter(
    { splitVertical: true });
  editor = CodeMirror(document.getElementById("code"),
          { lineNumbers: true,
            theme: 'tneighties',
            onChange: handle_code,
            value: "int fib(int n) {\n  if(n < 2) return 1;\n  return fib(n - 1) + fib(n - 2);\n}",
            mode: "text/x-csrc" });
  editor.getScrollerElement().style.height = '100%';
  $(window).resize(function(e) {
    editor.refresh();
    mipsviewer.refresh();
  });
  mipsviewer = CodeMirror(document.getElementById("mips"),
                          { mode: 'mips',
                            lineNumbers: true,
                            theme: 'tneighties',
                            readOnly: true,
                            firstLineNumber: 0,
                            indentUnit: 2 });
  mipsviewer.getScrollerElement().style.height = '100%';
  editor.refresh();
  handle_code();
});
</script>
<div id="ConsoleSplitter" class="splitter">
  <div id="CodeViewSplitter">
    <div id="code"></div>
    <div id="mips"></div>
  </div>
  <div> Console goes here!
</div>
