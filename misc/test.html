<!doctype html>
<meta charset="ascii">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"></script>
<style>
  div#tree div {
    border: 1px solid black;
    margin: 1px;
    display: inline-block;
    text-align: center;
  }
  div.list, div#tree div.array > div {
    display: block;
  }
  div#coloured span.name {
    
  }
  div#coloured span.int, span.hexint, span.zero, span.octal {
    background-color: #BBF;
  }
  div#coloured span.comment {
    background-color: #FBB;
    display: block;
  }
  div#coloured span.string {
    background-color: #BFB;
  }
</style>

<textarea id="code" rows=25 cols=80>
</textarea>

<p><input type=button onclick="go()" value="tokenize"></p>
<div id="coloured"></div>
<textarea id="out" rows=25 cols=80>
</textarea>
<p><input type=button onclick="onparse()" value="parse"></p>
<textarea id="parsed" rows=25 cols=80>
</textarea>

<div id="tree"></div>

<script>
var exports = window;
if(!console){
  console = { log: function(s){}}
}

/*Object.prototype.error = function(s, t) {
  console.log(s);
}*/


$(document).ready(function() {
  $.get('test.c', function(data) {
    document.getElementById("code").value = data;
  });
});


var tokens;
var go = function(){
  var code = document.getElementById("code").value;
  var coloured = document.getElementById("coloured")
  var S = "";
  var untokens = "";
  var t = tokenize_string(code);
  tokens = [];
  while(true) {
    var e = t.get()
    if(!e) break;
    var tokenspan = C('span')
    tokenspan.innerHTML = e.value;
    tokenspan.setAttribute('class', e.type);
    if(e.type == "newline") {
      tokenspan = C('br');
    }
    A(coloured, tokenspan);
    untokens += e.value;
    if(e.type != "whitespace" && e.type != "comment" && e.type != "newline") {
     //S += JSON.stringify(e) + "\n";
     S += e.value + " ";
     if(e.type == "(end)") { break; }
     tokens.push(e);
    }
  }
  if(untokens != code) {
    console.log("Failed round trip");
  }
  document.getElementById("out").value = S;
}

var tree;
var onparse = function() {
  console.log("parsing");
  var out = document.getElementById("parsed")
  out.value = "";
  var i = 0;
  var code = document.getElementById("code").value;
  tree = parse(tokenize_string(code));
  out.value = JSON.stringify(tree,
    ["value", "name", "first", "second", "third", "fourth", "arity"], '  ');

  var pic = draw(tree);
  var i = document.getElementById('tree');
  i.appendChild(pic);
}

</script>
<script src="tokenizer.js"></script>
<script src="parse.js"></script>
<script src="drawtree.js"></script>

